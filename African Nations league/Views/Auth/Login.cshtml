@{
    ViewData["Title"] = "Login";
    Layout = null; // or keep your own layout if preferred
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
:root {
    --caf-green: #126035;
    --caf-gold: #f3c24b;
    --bg: #062f22;
    --muted: #9aa6a0;
}

/* === PAGE BACKGROUND === */
.login-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: linear-gradient(180deg, rgba(2,10,6,0.75), rgba(2,10,6,0.55)), 
                url('/images/2025_Africa_Cup_of_Nations_logo.svg.png') center/cover no-repeat;
}

/* === CARD === */
.login-card {
    width: 100%;
    max-width: 1100px;
    display: grid;
    grid-template-columns: 1fr 420px;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 18px 48px rgba(2,10,6,0.45);
    background: rgba(255,255,255,0.04);
}

/* === LEFT PANEL === */
.login-info {
    background: linear-gradient(135deg, rgba(18,96,53,0.95), rgba(8,50,32,0.96));
    color: #fff;
    padding: 34px;
    position: relative;
}
.login-info .badge {
    background: var(--caf-gold);
    color: #0b2b1f;
    padding: 6px 10px;
    border-radius: 8px;
    font-weight: 800;
}
.login-info h1 {
    margin: 10px 0 6px 0;
    font-size: 1.5rem;
    font-weight: 900;
}
.login-info p {
    color: rgba(255,255,255,0.9);
    margin: 0;
    line-height: 1.5;
}
.login-info .cup {
    position: absolute;
    right: 18px;
    bottom: 14px;
    opacity: 0.12;
    width: 180px;
    pointer-events: none;
}

/* === RIGHT FORM === */
.login-form {
    background: #fff;
    padding: 28px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.login-form h2 {
    font-weight: 800;
    color: var(--bg);
    margin-bottom: 8px;
}

.form-control {
    border-radius: 10px;
    border: 1px solid rgba(2,10,6,0.06);
    padding: 10px 12px;
}

.btn-primary {
    background: linear-gradient(90deg, var(--caf-green), #0f7a4d);
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 12px;
    font-weight: 800;
}

.btn-secondary {
    background: #ddd;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    padding: 10px 12px;
    color: #333;
}

.alert-err {
    background: #ffefef;
    color: #6b0a0a;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid rgba(150,0,0,0.08);
    font-weight: 700;
}

.login-footer {
    text-align: center;
    margin-top: 10px;
    font-size: 0.95rem;
    color: #555;
}

/* === Responsive === */
@@media (max-width: 980px) {
    .login-card {
        grid-template-columns: 1fr;
        max-width: 760px;
    }
    .login-info {
        order: 2;
        padding: 20px;
    }
    .login-form {
        order: 1;
        padding: 20px;
    }
}
</style>

<div class="login-page">
    <div class="login-card" role="main" aria-labelledby="loginTitle">

        <!-- LEFT: INFO -->
        <aside class="login-info">
            <div class="badge">CAF • Morocco 2025</div>
            <h1>TotalEnergies Africa Cup of Nations</h1>
            <p style="margin-top: 6px;">Morocco — 21 Dec 2025 → 18 Jan 2026</p>
            <p style="margin-top: 18px;">
                Follow your team, check live results and experience the thrill of African football.
            </p>
            <img src="/images/2025_Africa_Cup_of_Nations_logo.svg.png" alt="CAF Cup" class="cup" />
        </aside>

        <!-- RIGHT: FORM -->
        <section class="login-form" aria-labelledby="loginTitle">
            <h2 id="loginTitle">Login</h2>

            @if (TempData["Error"] != null)
            {
                <div class="alert-err">@TempData["Error"]</div>
            }

            <form action="@Url.Action("Login","Auth")" method="post" id="loginForm" autocomplete="on" novalidate>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input id="email" name="email" type="email" class="form-control" placeholder="your@mail.com" required />
                </div>

                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input id="password" name="password" type="password" class="form-control" placeholder="Password" required minlength="6" />
                </div>

                <button type="submit" class="btn-primary w-100 mb-2">Sign in</button>

                <a href="@Url.Action("SignUp", "Auth")" class="btn btn-outline-success w-100 mb-2">Don’t have an account? Sign up</a>
                <a href="@Url.Action("Index", "Home")" class="btn-secondary w-100 mb-2">🏠 Back to home</a>
            </form>
        </section>
    </div>
</div>

<script>
/*
  Client-side validation script (simple and clean)
  - Keeps the same fields and form action.
  - Validates email format and password length.
  - Displays inline alert if invalid.
  - Submits via Fetch to detect server-side "incorrect credentials" responses without a full reload.
*/
(function () {
  const form = document.getElementById('loginForm');
  if (!form) return;

  form.addEventListener('submit', function (e) {
    // remove any previous error
    document.querySelectorAll('.client-error').forEach(function(el) { el.remove(); });

    const email = form.email.value.trim();
    const password = form.password.value.trim();
    const errors = [];

    
    var emailRegex = new RegExp("^[^\\s@@]+@@[^\\s@@]+\\.[^\\s@@]+$");
    if (!email || !emailRegex.test(email)) errors.push('Please enter a valid email address.');
    if (!password || password.length < 6) errors.push('Password must be at least 6 characters.');

    if (errors.length > 0) {
      e.preventDefault();

      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert-err client-error';
      alertDiv.innerHTML = '<ul style="margin:0;padding-left:18px;">' +
        errors.map(function(err) { return '<li>' + err + '</li>'; }).join('') +
        '</ul>';

      form.prepend(alertDiv);
      alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return;
    }

    // Submit via Fetch to enable inline display of "incorrect credentials" errors when server supports JSON
    e.preventDefault();

    const fd = new FormData(form);
    fetch(form.action, {
      method: 'POST',
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
        'Accept': 'application/json'
      },
      body: fd,
      credentials: 'same-origin'
    }).then(function (resp) {
      const ct = resp.headers.get('content-type') || '';

      // If server returned JSON, honor it (expected shape: { success: bool, error?: string, redirectUrl?: string })
      if (ct.indexOf('application/json') !== -1) {
        return resp.json().then(function (json) {
          if (json.success) {
            if (json.redirectUrl) window.location = json.redirectUrl;
            else window.location.reload();
          } else {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert-err client-error';
            alertDiv.textContent = json.error || 'Invalid credentials.';
            form.prepend(alertDiv);
            alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        });
      }

      // If server redirected (normal form success), follow it
      if (resp.redirected) {
        window.location = resp.url;
        return;
      }

      // For non-JSON responses, show a friendly message on common failure statuses
      if (!resp.ok) {
        const errText = resp.status === 401 ? 'Invalid email or password.' : 'Login failed. Please try again.';
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert-err client-error';
        alertDiv.textContent = errText;
        form.prepend(alertDiv);
        alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }

      // Finally, fallback: if server returned HTML (likely the login form again), try to surface server error by replacing page
      return resp.text().then(function (html) {
        if (html.indexOf('class="alert-err"') !== -1 || html.indexOf('alert-err') !== -1) {
          document.open();
          document.write(html);
          document.close();
        } else {
          // fallback to full submit if we can't interpret the response
          form.submit();
        }
      });
    }).catch(function () {
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert-err client-error';
      alertDiv.textContent = 'Network error. Please try again.';
      form.prepend(alertDiv);
      alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
  });
})();
</script>